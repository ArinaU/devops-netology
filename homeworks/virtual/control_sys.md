### Домашнее задание к занятию "5.2. Системы управления виртуализацией"

https://github.com/netology-code/virt-homeworks/tree/master/05-virt-02-control-systems

## 1.
* 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований
Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий:

    Решение: возможно Hyper-V, раз преимущественно Windows based инфраструктура, сервисы могут быть масштабированы и Hyper-V все-таки поддерживает Linux, однако возможно лучше AWS? AWS гарантирует доступность и отказоустойчивость и в нем есть сервисы для автоматизации резервных копий, балансировки нагрузки и репликации.


* Требуется наиболее производительное бесплатное opensource решение для виртуализации небольшой (20 серверов) инфраструктуры Linux и Windows виртуальных машин

    Решение: Возможно KVM, если нужна производительность, но раз имеет проблемы под нагрузкой, а серверов 20, то возможно лучше более надежный Xen

* Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры
    Решение: KVM бесплатный, совместим с Windows и отличается производительностью

* Необходимо рабочее окружение для тестирование программного продукта на нескольких дистрибутивах Linux
    Решение: VirtualBox подходит для рабочего окружения, легко запускать и управлять с конфигами Vagrant

## 2.
Перед конвертацией необходимо сделать backup изначальной ВМ. Также необходимо убедиться в следующем:
* Hyper-V название ВМ не должно иметь UTF символы.
* Спецификация RAM и диска для исходной ВМ должна соответствовать формату целевой ВМ.
* Прежде чем выполнять резервное копирование исходной ВМ Linux, необходимо убедиться, что на исходной ВМ установлены необходимые драйверы Hyper-V. Эти драйверы должны присутствовать в резервной копии исходной ВМ для загрузки ВМ после преобразования.

Далее есть несколько методов конвертации, предоставленные Microsoft:
* Использование Microsoft Virtual Machine Converter (MVMC). MVMC - бесплатный автономный инструмент с GUI, который может преобразовывать ВМ. Инструмент также может преобразовать физическую машину в виртуальную.
* Преобразование VMDK в VHD и подключение преобразованного виртуального диска к новой ВМ Hyper-V с помощью PowerShell. Этот метод можно использовать, когда есть файлы виртуального диска, но не все файлы ВМ (например, файлы конфигурации VMX).
* Преобразование виртуальных машин с помощью SCVMM (System Center Virtual Machine Manager). SCVMM обеспечивает централизованное управление средами Hyper-V и VMware, включая виртуальные машины, хосты и кластеры. Этот инструмент включает в себя функции преобразования ВМ.

Необходимые шаги для использования всех преимуществ Hyper-V для Windows:
* Инсталлировать Hyper-V на Windows Server Core - при установке Windows Server устанавливаются минимальные файлы для выполнения поддерживаемых серверных ролей, таких как Hyper-V, без GUI и других второстепенных подсистем, это экономит память.
* 32-разрядные операционные системы Windows могут использовать только до 2 ГБ виртуального адресного пространства на процесс. Между тем, 64-разрядная версия ОС позволяет приложениям в полной мере использовать память, установленную на хосте Hyper-V.
* Hyper-V Integration Services - набор специальных драйверов и утилит, предназначенных для повышения производительности гостевых ОС, работающих внутри Hyper-V. Для достижения оптимальных результатов рекомендуется включить службы интеграции Hyper-V как на узле Hyper-V, так и во всех гостевых ОС.
* Использовать фиксированные файлы VHD - диски фиксированного размера обеспечивают лучшую производительность и рекомендуются для серверов, на которых выполняются приложения с высоким уровнем дисковой активности. Также пространство дисков фиксированного размера выделяется при создании файла виртуального жесткого диска и не изменяется при добавлении или удалении данных, поэтому лучше для продакшена.
* Не использовать снэпшоты Hyper-V в качестве альтернативы резервному копированию: Pagefile.sys - файл подкачки Windows, используемый для управления виртуальной памятью и проблемами с нехваткой памяти. Когда в системе начинает не хватать физической памяти, можно получить доступ к дополнительной оперативной памяти с помощью файлов подкачки. Хотя это может показаться хорошей идеей, использование файла подкачки иможет повлиять на производительность ВМ.
* Многопутевой ввод-вывод (MPIO) может обеспечить несколько избыточных путей к данным между устройствами хранения и сервером, что в результате может улучшить балансировку нагрузки и обеспечить высокую доступность среды Hyper-V. Стоит включить эту функцию в production среде, если идет работа с большими объемами данных.



## 3.
Конечно однородную систему легче поддерживать, однако с увеличением необходимости привлечения большего количества потенциальных пользователей система эволюционирует со временем в гетерогенную. Например, можно создавать софт конкретно под Windows, тогда скорее всего выбор падет на Hyper-V, однако для большей прибыли вероятно лучше создавать продукт с поддержкой разных ОС.
Для поддержки гетерогенной системы можно предпринять следующие шаги:
* Сгруппировать похожее оборудование вместе для максимальной эффективности: у каждой аппаратной платформы есть свои особенности и нюансы, и, поскольку виртуализация очень требовательна к физическому оборудованию, стоит группировать подобное оборудование вместе, когда это возможно. Например, так как процессоры AMD и Intel используют разные архитектуры, нельзя перемещать работающую виртуальную машину между хостами с процессорами разных производителей.
* Все-таки стараться придерживаться одной платформы гипервизора для своей производственной среды: причины для этого следующие:
    * Необходимое в таком случае повышение квалификации разработчиков - персоналу придется постоянно поддерживать квалификацию для работы с несколькими гипервизорными платформами;
    * Необходимо платить за несколько продуктов одновременно, когда можно было использовать одну и снизить стоимость;
    * Существует некоторая совместимость гипервизоров между гипервизорами с использованием инструментов преобразования, но, поскольку они используют разные форматы дисков, это может быть неудобным в использовании;
* Добавление еще одной платформы виртуализации должно быть запланированным: иногда имеет смысл с финансовой точки зрения смешивать платформы гипервизоров для конкретных случаев использования. Использование альтернативных более дешевых или бесплатных платформ гипервизора может помочь расширить использование виртуализации при одновременном снижении затрат. Можно использовать одну основную платформу гипервизора для продакшена (например более дорогую), а дополнительную - для сред разработки и тестирования (open source). Можно использовать один и тот же гипервизор для продакшена и тестирования, чтобы можно было проверить проблемы, которые возникают при запуске приложения на определенном гипервизоре, прежде чем оно будет запущено в продакшн.
* С другой стороны, несмотря на то, что, например, VMware и Microsoft пытались обеспечивать поддержку также противоположной платформы, эти решения все равно ограничены и неудобны. Поэтому лучше использовать при необходимости дефолтную систему виртуализации для ОС (Например Hyper-V для Windows систем). Все зависит от требований к продукту и запланированному уровню затрат компании.
  



